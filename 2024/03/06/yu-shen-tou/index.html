

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="alazymachine">
  <meta name="keywords" content="">
  
    <meta name="description" content="信息收集  **oneforall:**子域名收集工具  whois****查询  多地ping查询是否存在CDN服务器，nslookup若存在多个IP则证明有****CDN   国外ping一般会是真正的服务器 历史DNS解析 利用fofa，比如在图标中会有一串唯一的哈希，可以利用网络空间搜索引擎全网ip信息进行排序 依照网站证书，按照证书上的序列号转换为10进制，去fofa上搜   C****">
<meta property="og:type" content="article">
<meta property="og:title" content="域渗透">
<meta property="og:url" content="https://alazymechnaic.github.io/2024/03/06/yu-shen-tou/index.html">
<meta property="og:site_name" content="alazymachine">
<meta property="og:description" content="信息收集  **oneforall:**子域名收集工具  whois****查询  多地ping查询是否存在CDN服务器，nslookup若存在多个IP则证明有****CDN   国外ping一般会是真正的服务器 历史DNS解析 利用fofa，比如在图标中会有一串唯一的哈希，可以利用网络空间搜索引擎全网ip信息进行排序 依照网站证书，按照证书上的序列号转换为10进制，去fofa上搜   C****">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-03-06T13:00:00.000Z">
<meta property="article:modified_time" content="2024-03-06T13:52:37.552Z">
<meta property="article:author" content="alazymachine">
<meta property="article:tag" content="渗透">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>域渗透 - alazymachine</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"alazymechnaic.github.io","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="域渗透"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-03-06 21:00" pubdate>
          2024年3月6日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          2.6k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          22 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">域渗透</h1>
            
            
              <div class="markdown-body">
                
                <p><strong>信息收集</strong></p>
<ul>
<li><p>**oneforall:**子域名收集工具</p>
</li>
<li><p><strong>whois****查询</strong></p>
</li>
<li><p><strong>多地<strong><strong>ping</strong></strong>查询是否存在<strong><strong>CDN</strong></strong>服务器，<strong><strong>nslookup</strong></strong>若存在多个<strong><strong>IP</strong></strong>则证明有****CDN</strong></p>
</li>
<li><ul>
<li><strong>国外<strong><strong>ping</strong></strong>一般会是真正的服务器</strong></li>
<li><strong>历史<strong><strong>DNS</strong></strong>解析</strong></li>
<li><strong>利用<strong><strong>fofa</strong></strong>，比如在图标中会有一串唯一的哈希，可以利用网络空间搜索引擎全网<strong><strong>ip</strong></strong>信息进行排序</strong></li>
<li><strong>依照网站证书，按照证书上的序列号转换为<strong><strong>10</strong></strong>进制，去<strong><strong>fofa</strong></strong>上搜</strong></li>
</ul>
</li>
<li><p><strong>C****段查询</strong></p>
</li>
<li><p><strong>文件泄露扫描：使用目录扫描器，<strong><strong>svn</strong></strong>，<strong><strong>swp</strong></strong>，<strong><strong>git</strong></strong>文件泄露</strong></p>
</li>
</ul>
<p><strong>系统后门：</strong></p>
<ul>
<li><p><strong>Windows****：</strong></p>
</li>
<li><ul>
<li><strong>SC****后门，将后门程序注册为自启动服务</strong></li>
<li><strong>WMI****后门：</strong>必须要在提权成功后才能够使用，UAC机制会阻碍该方法（需要在empire中可以进行bypass uac，然后在empire中找到persistence/elevated/wmi模块执行，而后在主机上发送</li>
</ul>
</li>
</ul>
<p>Get-WMIObject-Namespaceroot\Subscription-ClassCommandLineEventConsumer-Filter“Name=’Updater’”即可创建WMI后门</p>
<ul>
<li><p>Linux后门</p>
</li>
<li><ul>
<li>pam后门</li>
<li>vim后门</li>
</ul>
</li>
</ul>
<p><strong>关于免杀</strong></p>
<ul>
<li><p><strong>文件免杀：</strong></p>
</li>
<li><ul>
<li><p><strong>webshell****：混淆，加密</strong></p>
</li>
<li><p><strong>C2****工具：</strong></p>
</li>
<li><ul>
<li><strong>利用加载器伪装，加载<strong><strong>shellcode</strong></strong>，将<strong><strong>shellcode</strong></strong>生成出来。</strong></li>
<li><strong>DLL****劫持，进行代码的注入</strong></li>
<li><strong>载荷分离，将载荷放在公网的服务器上，每次调用时会下载载荷执行</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>Kerberos原理</strong>：</p>
<ul>
<li><p>客户机向AS发送通信请求，其中内容是客户机的明文ID</p>
</li>
<li><p>AS检查该ID是否合法，若合法则从数据库中找到对应的NTLM  HASH（该用户密码的NTLM哈希值）用作和客户机通信的加密密钥。</p>
</li>
<li><p>即UserHash(infor，TGT)</p>
</li>
<li><p>其中的TGT=TgsHash(用户id，客户端网络地址，票据有效信息和客户机的NTLM     Hash)</p>
</li>
<li><p>客户机解密出来TGT后，向TGS发出TGT，要访问的服务器的ID，使用自己NTLM     Hash加密的时间戳等信息</p>
</li>
<li><p>TGS拿到消息后，先解开TGT，得到客户机的HASH，而后利用该HASH解密客户机发来的身份认证，从而证实客户机的身份。随后TGS生成客户机与服务器的会话密钥，利用服务器端的Hash加密一份会话密钥，外层用客户端的哈希加密后发送给客户机</p>
</li>
<li><p>客户机解密后得到会话密钥，同时将对应服务器端的密钥发送给服务器</p>
</li>
<li><p>密钥交换完成</p>
</li>
<li><p>注意：</p>
</li>
<li><ul>
<li>其中KDC包含（AS，TGS）</li>
<li>AS用于生成临时会话票据TGT</li>
<li>TGS用于为客户访问服务器生成Ticket</li>
</ul>
</li>
</ul>
<p><strong>黄金票据</strong>：伪造TGT，需要窃取域控的NTLM HASH，用于TGT的构成是利用TGS的哈希加密的内容，因此得到域控用户的哈希后可以不通过AS而伪造出TGT</p>
<p><strong>白银票据</strong>：伪造Ticket 需要目标服务器的NTLM Hash，由于Ticket的构成需要两个密钥，一个本地用户的哈希，另一个是服务器用户的哈希，从而构造出Ticket，可以使其不与域控进行通信而完成密钥的协商</p>
<p><strong>静态抓取方式：</strong></p>
<p><img src="data:image/png;base64,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" srcset="/img/loading.gif" lazyload alt="reg save HKl_m SYSTEM c: windows temp Sys. hiv  • ndows temp Sam. hiv  reg save HKLm SYSTEM c: "></p>
<p>而后使用mimikatz进行明文密码的抓取</p>
<p><strong>动态抓取方式：</strong></p>
<p><strong>使用<strong><strong>procdump.exe</strong></strong>对<strong><strong>lsas.exe</strong></strong>的内存<strong><strong>dump</strong></strong>到本地。其中<strong><strong>lsass.exe</strong></strong>用于进行密码验证因此会存有明文密码</strong></p>
<p><strong>使用<strong><strong>sqldumper.exe</strong></strong>（<strong><strong>mssql</strong></strong>安装目录下提取出来的工具），****sekurlsa::minidump</strong></p>
<p><strong>mimikatz<strong><strong>进行</strong></strong>debug<strong><strong>从而进行</strong></strong>NTLM****哈希的抓取：</strong></p>
<p><strong>而后进行分析</strong></p>
<p><strong>横向移动：</strong></p>
<ul>
<li><p><strong>信息收集：</strong></p>
</li>
<li><ul>
<li><strong>内网结构，键盘记录，每个主机上各种密码收集，构造字典</strong></li>
</ul>
</li>
<li><p><strong>移动方法：</strong></p>
</li>
<li><ul>
<li><strong>弱口令</strong></li>
<li><strong>高危内网服务</strong></li>
<li><strong>web</strong></li>
<li><strong>bloodhound****一把梭</strong></li>
</ul>
</li>
<li><p>利用猕猴桃获得其他主机的凭证，在域内进行横向的转移</p>
</li>
<li><p>WMIC工具能够进行远程命令执行</p>
</li>
<li><p>WCE工具能够进行远程哈希注入</p>
</li>
<li><p>MSF的PSEXEC模块能够进行哈希传递</p>
</li>
<li><p>netsh能够进行防火墙的规则设置</p>
</li>
<li><p>psexec哈希传递</p>
</li>
<li><p>smb重放（攻击者进行中间人攻击，由于SMB认证是基于挑战响应机制的，因此作为中间人可以直接转发客户机的challenge值），远程计划任务</p>
</li>
</ul>
<p><strong>端口扫描：</strong></p>
<p><strong>nmap****：</strong></p>
<p>-sP 使用ping扫描</p>
<p>-PE ICMP扫描</p>
<p>-sS 半开式扫描</p>
<p><strong>漏洞扫描工具</strong></p>
<ul>
<li><strong>AWVS<strong><strong>，</strong></strong>APPSCAN<strong><strong>，</strong></strong>nessus</strong></li>
<li><strong>nmap     –script</strong> <strong>选择脚本</strong></li>
</ul>
<p><strong>内网流量代理工具</strong></p>
<ul>
<li><p><strong>流量代理</strong></p>
</li>
<li><ul>
<li><strong>frp</strong></li>
<li><strong>nps</strong></li>
<li><strong>venom</strong></li>
</ul>
</li>
<li><p><strong>本地转发</strong></p>
</li>
<li><ul>
<li><strong>windows<strong><strong>：</strong></strong>netsh</strong></li>
<li><strong>linux<strong><strong>：</strong></strong>ssh</strong></li>
</ul>
</li>
</ul>
<p><strong>DNS<strong><strong>相关内容</strong></strong>：</strong></p>
<ul>
<li><p><strong>DNS</strong> <strong>A记录****：即用来指定主机名（域名）对应的IP地址记录，用户可以将该域名下的网站服务器指向到自己的web</strong> <strong>server上****。</strong></p>
</li>
<li><p><strong>CNAME记录：别名<strong><strong>解析</strong></strong>，由主机名到主机名到映射，当需要将域名指向另一个域名，再由另一个域名提供IP地址时需要CNAME记录，包括CDN，企业邮箱等操作。</strong></p>
</li>
<li><p><strong>A记录和CNAME记录之间的区别：CNAME可以实现一台服务器上搭载多个网站，也就是多个域名解析到一个主机名上，该主机名对应一条A记录，用于解析域名到IP之间的记录，当主机需要更换IP时，只修改该A记录即可</strong></p>
</li>
<li><p><strong>域名与IP之间的关系：</strong></p>
</li>
<li><ul>
<li><strong>一个域名可以对应多个IP，用于实现类似负载均衡。一个域名设置多个dns服务器进行解析，同一个域名的不同解析会指向不同的地址，这样应答快的dns现解析，这样就可以保证最快定向到指定的网站空间去。</strong></li>
<li><strong>一个IP也可以对应多个域名：例如CNAME记录就是这类方式。将不通过的域名通过CNAME映射到同一个域名上去。</strong></li>
</ul>
</li>
</ul>
<p><strong>http相关内容：</strong></p>
<ul>
<li><p><strong>Accept字段****：在http请求数据包中，用于告知服务器自己接受什么样的数据</strong></p>
</li>
<li><ul>
<li><strong>Text</strong><strong>/html****，</strong> <strong>image/jpeg</strong></li>
</ul>
</li>
<li><p><strong>Content-Type****：表名实体主体的文件类型（文件上传绕过可以尝试该方式）</strong></p>
</li>
<li><p><strong>Referer：用于告知服务器，客户机是从哪个资源来访问服务器的</strong></p>
</li>
<li><p><strong>X</strong><strong>-Forward-For****：与Referer不同之处在于其填写的内容是IP，而XFF填写的内容是上一个访问的资源地址。在进行编程时选择使用remote</strong> <strong>addr则得到的是真实IP****，即进行握手时的IP。而XFF是可以进行伪造的。当使用类似Nginx进行反向代理时，remote</strong> <strong>addr得到的是代理服务器的IP****，因此需要填写XFF指向真正的外部用户。当然真正的web服务器此时需要禁止对外提供服务。</strong></p>
</li>
</ul>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E6%B8%97%E9%80%8F/">#渗透</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>域渗透</div>
      <div>https://alazymechnaic.github.io/2024/03/06/yu-shen-tou/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>alazymachine</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年3月6日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/03/09/jvm-zi-jie-ma-ru-men/" title="jvm字节码入门">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">jvm字节码入门</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/03/06/mo-ban-zhu-ru/" title="模板注入">
                        <span class="hidden-mobile">模板注入</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
