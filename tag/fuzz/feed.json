{
    "version": "https://jsonfeed.org/version/1",
    "title": "alazymachine • All posts by \"fuzz\" tag",
    "description": "",
    "home_page_url": "https://alazymechnaic.github.io",
    "items": [
        {
            "id": "https://alazymechnaic.github.io/2023/08/30/afl-fuzz-diy/",
            "url": "https://alazymechnaic.github.io/2023/08/30/afl-fuzz-diy/",
            "title": "afl_fuzz_DIY",
            "date_published": "2023-08-30T08:38:13.000Z",
            "content_html": "<h1 id=\"AFL\"><a href=\"#AFL\" class=\"headerlink\" title=\"AFL ++\"></a>AFL ++</h1><hr>\n<h2 id=\"afl-for-binary\"><a href=\"#afl-for-binary\" class=\"headerlink\" title=\"afl for binary\"></a>afl for binary</h2><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">dop@ubuntu:~$ <span class=\"token assign-left variable\">AFL_QEMU_DEBUG_MAPS</span><span class=\"token operator\">=</span><span class=\"token number\">1</span> afl-qemu-trace ./ciscn_2019_c_1\n<span class=\"token number\">400000</span>-402000 r-xp 00000000 08:05 <span class=\"token number\">1617251</span>                                /home/dop/ciscn_2019_c_1\n<span class=\"token number\">402000</span>-601000 ---p 00000000 00:00 <span class=\"token number\">0</span>\n<span class=\"token number\">601000</span>-602000 r--p 00001000 08:05 <span class=\"token number\">1617251</span>                                /home/dop/ciscn_2019_c_1\n<span class=\"token number\">602000</span>-603000 rw-p 00002000 08:05 <span class=\"token number\">1617251</span>                                /home/dop/ciscn_2019_c_1\n<span class=\"token number\">4000000000</span>-4000001000 ---p 00000000 00:00 <span class=\"token number\">0</span>\n<span class=\"token number\">4000001000</span>-4000801000 rw-p 00000000 00:00 <span class=\"token number\">0</span>                              <span class=\"token punctuation\">[</span>stack<span class=\"token punctuation\">]</span>\n<span class=\"token number\">4000801000</span>-4000802000 r--p 00000000 08:05 <span class=\"token number\">1968235</span>                        /usr/lib/x86_64-linux-gnu/ld-2.31.so\n<span class=\"token number\">4000802000</span>-4000825000 r-xp 00001000 08:05 <span class=\"token number\">1968235</span>                        /usr/lib/x86_64-linux-gnu/ld-2.31.so\n<span class=\"token number\">4000825000</span>-400082d000 r--p 00024000 08:05 <span class=\"token number\">1968235</span>                        /usr/lib/x86_64-linux-gnu/ld-2.31.so\n400082d000-400082e000 ---p 00000000 00:00 <span class=\"token number\">0</span>\n400082e000-400082f000 r--p 0002c000 08:05 <span class=\"token number\">1968235</span>                        /usr/lib/x86_64-linux-gnu/ld-2.31.so\n400082f000-4000830000 rw-p 0002d000 08:05 <span class=\"token number\">1968235</span>                        /usr/lib/x86_64-linux-gnu/ld-2.31.so\n<span class=\"token number\">4000830000</span>-4000833000 rw-p 00000000 00:00 <span class=\"token number\">0</span>\n<span class=\"token number\">4000847000</span>-4000869000 r--p 00000000 08:05 <span class=\"token number\">1968239</span>                        /usr/lib/x86_64-linux-gnu/libc-2.31.so\n<span class=\"token number\">4000869000</span>-40009e1000 r-xp 00022000 08:05 <span class=\"token number\">1968239</span>                        /usr/lib/x86_64-linux-gnu/libc-2.31.so\n40009e1000-4000a2f000 r--p 0019a000 08:05 <span class=\"token number\">1968239</span>                        /usr/lib/x86_64-linux-gnu/libc-2.31.so\n4000a2f000-4000a33000 r--p 001e7000 08:05 <span class=\"token number\">1968239</span>                        /usr/lib/x86_64-linux-gnu/libc-2.31.so\n4000a33000-4000a35000 rw-p 001eb000 08:05 <span class=\"token number\">1968239</span>                        /usr/lib/x86_64-linux-gnu/libc-2.31.so\n4000a35000-4000a3b000 rw-p 00000000 00:00 <span class=\"token number\">0</span>\nffffffffff600000-ffffffffff601000 <span class=\"token parameter variable\">--xp</span> 00000000 00:00 <span class=\"token number\">0</span>                  <span class=\"token punctuation\">[</span>vsyscall<span class=\"token punctuation\">]</span>\nEEEEEEE                            hh      iii\nEE      mm mm mmmm    aa aa   cccc hh          nn nnn    eee\nEEEEE   mmm  mm  mm  aa aaa cc     hhhhhh  iii nnn  nn ee   e\nEE      mmm  mm  mm aa  aaa cc     hh   hh iii nn   nn eeeee\nEEEEEEE mmm  mm  mm  aaa aa  ccccc hh   hh iii nn   nn  eeeee\n<span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span>\nWelcome to this Encryption machine\n\n<span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span>\n<span class=\"token number\">1</span>.Encrypt\n<span class=\"token number\">2</span>.Decrypt\n<span class=\"token number\">3</span>.Exit\nInput your choice<span class=\"token operator\">!</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><img data-src=\"https://alazymechnaic.oss-cn-hangzhou.aliyuncs.com/blog-page/202309172015669.png\" alt=\"image-20230901091314691\"></p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">AFL_QEMU_PERSISTENT_ADDR</span><span class=\"token operator\">=</span>0x400B28\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">AFL_QEMU_PERSISTENT_GPR</span><span class=\"token operator\">=</span><span class=\"token number\">1</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<h2 id=\"无源码测试\"><a href=\"#无源码测试\" class=\"headerlink\" title=\"无源码测试\"></a>无源码测试</h2><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\"># 无源码测试基于qemu实现，首先配置qemu</span>\n$ <span class=\"token builtin class-name\">cd</span> qemu_mode\n$ ./build_qemu_support.sh\n<span class=\"token comment\"># 设置原始输入和输出</span>\n$ <span class=\"token function\">mkdir</span> fuzz_in\n$ <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"hello\"</span> <span class=\"token operator\">&gt;</span> fuzz_in/testcase\n$ gcc test.c <span class=\"token parameter variable\">-o</span> <span class=\"token builtin class-name\">test</span>\n$ afl-fuzz <span class=\"token parameter variable\">-i</span> fuzz_in <span class=\"token parameter variable\">-o</span> fuzz_out <span class=\"token parameter variable\">-Q</span> ./test<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><img data-src=\"https://alazymechnaic.oss-cn-hangzhou.aliyuncs.com/blog-page/202309172015117.png\" alt=\"image-20230901102144519\"></p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\"># 输出结果</span>\n└── default\n    ├── cmdline\n    ├── crashes\n    │   ├── id:000000,sig:11,src:000000+000030,time:3961,execs:13145,op:splice,rep:4\n    │   ├── id:000001,sig:04,src:000000+000030,time:3961,execs:13146,op:splice,rep:5\n    │   ├── id:000002,sig:04,src:000000+000026,time:3985,execs:13213,op:splice,rep:8\n    │   ├── id:000003,sig:11,src:000043+000009,time:4075,execs:13502,op:splice,rep:16\n    │   ├── id:000004,sig:11,src:000035+000023,time:4240,execs:14064,op:splice,rep:16\n    │   ├── id:000005,sig:11,src:000025+000037,time:4319,execs:14316,op:splice,rep:6\n    │   └── README.txt\n    ├── fuzz_bitmap\n    ├── fuzzer_setup\n    ├── fuzzer_stats\n    ├── hangs\n    ├── plot_data\n    └── queue\n        ├── id:000000,time:0,execs:0,orig:testcase\n        ├── id:000001,src:000000,time:4,execs:12,op:havoc,rep:2,+cov\n        ├── id:000002,src:000000,time:6,execs:20,op:havoc,rep:1\n        ├── id:000003,src:000000,time:9,execs:28,op:havoc,rep:1\n        ├── id:000004,src:000000,time:12,execs:37,op:havoc,rep:1\n<span class=\"token comment\"># </span>\ncrashes：存放去重后触发crash的数据\n\nfuzz_bitmap：记录代码覆盖率\n\nfuzzer_stats：fuzz状态\n\nhangs：存放去重后触发挂起的数据\n\nplot_data：绘图数据\n\nqueue：有效的样本集合\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>如果需要对so文件进行测试，需要将相应的动态链接库目录加入到环境变量中</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">QEMU_LD_PREFIX</span><span class=\"token operator\">=</span><span class=\"token variable\">$LD_LIBRARY_PATH</span><span class=\"token builtin class-name\">:</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">LD_LIBRARY_PATH</span><span class=\"token operator\">=</span><span class=\"token variable\">$LD_LIBRARY_PATH</span>\n<span class=\"token comment\"># 两个都试试吧</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"自定义fuzz策略\"><a href=\"#自定义fuzz策略\" class=\"headerlink\" title=\"自定义fuzz策略\"></a>自定义fuzz策略</h2><p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYW5xdWFua2UuY29tL3Bvc3QvaWQvMjU0MzYz\">https://www.anquanke.com/post/id/254363</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0FGTHBsdXNwbHVzL0FGTHBsdXNwbHVzL2Jsb2IvZGV2L2RvY3MvY3VzdG9tX211dGF0b3JzLm1kJUUzJTgwJTgx\">https://github.com/AFLplusplus/AFLplusplus/blob/dev/docs/custom_mutators.md、</span></p>\n<h3 id=\"官方自定义文档\"><a href=\"#官方自定义文档\" class=\"headerlink\" title=\"官方自定义文档\"></a>官方自定义文档</h3><p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0FGTHBsdXNwbHVzL0FGTHBsdXNwbHVzL2Jsb2IvZGV2L2RvY3MvY3VzdG9tX211dGF0b3JzLm1kIzItYXBpcw==\">https://github.com/AFLplusplus/AFLplusplus/blob/dev/docs/custom_mutators.md#2-apis</span></p>\n<h3 id=\"安装libprotobuf\"><a href=\"#安装libprotobuf\" class=\"headerlink\" title=\"安装libprotobuf\"></a>安装libprotobuf</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\"># 提示cmake 版本太低 https://www.cnblogs.com/jsdy/p/12689470.html#_label0</span>\n升级cmake \n$ <span class=\"token function\">wget</span> http://www.cmake.org/files/v3.25/cmake-3.25.2.tar.gz\n./bootstrap\n<span class=\"token function\">make</span>\n<span class=\"token function\">make</span> <span class=\"token function\">install</span>\n<span class=\"token comment\"># 出找不到openssl </span>\nCould NOT <span class=\"token function\">find</span> OpenSSL, try to <span class=\"token builtin class-name\">set</span> the path to OpenSSL root folder <span class=\"token keyword\">in</span> the system variable OPENSSL_ROOT_DIR <span class=\"token punctuation\">(</span>missing: OPENSSL_LIBRARIES OPENSSL_INCLUDE_DIR<span class=\"token punctuation\">)</span> \n$ <span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> libssl-dev\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>安装libxml4</p>\n<p>autogen.sh </p>\n<p>报错：<br>configure.ac:1087: error: possibly undefined macro: m4_ifdef<br>      If this token and others are legitimate, please use m4_pattern_allow.<br>      See the Autoconf documentation.</p>\n<p>解决方案：sudo cp /usr/share/aclocal/*.m4 /usr/local/share/aclocal/<br><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20veTQyNDc0NjQvcC8xNDM4ODMzNC5odG1s\">https://www.cnblogs.com/y4247464/p/14388334.html</span></p>\n<p><img data-src=\"https://alazymechnaic.oss-cn-hangzhou.aliyuncs.com/blog-page/202309081527504.png\">\t</p>\n<p>本文介绍如何利用AFL Plus Plus实现自定义目标的模糊测试。</p>\n<p>Tutorials ： <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0FGTHBsdXNwbHVzL0FGTHBsdXNwbHVzL2Jsb2Ivc3RhYmxlL2RvY3MvdHV0b3JpYWxzLm1k\">https://github.com/AFLplusplus/AFLplusplus/blob/stable/docs/tutorials.md</span></p>\n<h2 id=\"AFL源码阅读\"><a href=\"#AFL源码阅读\" class=\"headerlink\" title=\"AFL源码阅读\"></a>AFL源码阅读</h2><pre class=\"line-numbers language-c\" data-language=\"c\"><code class=\"language-c\"><span class=\"token comment\">// afl-fuzz.h: line 431</span>\n<span class=\"token comment\">// 该结构用于存储本次afl运行所需要的上下文内容</span>\n<span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">afl_state</span> <span class=\"token punctuation\">{</span>\n<span class=\"token comment\">/* Position of this state in the global states list */</span>\n  u32 _id<span class=\"token punctuation\">;</span>\n\n  <span class=\"token class-name\">afl_forkserver_t</span> fsrv<span class=\"token punctuation\">;</span>\n  <span class=\"token class-name\">sharedmem_t</span>      shm<span class=\"token punctuation\">;</span>\n  <span class=\"token class-name\">sharedmem_t</span>     <span class=\"token operator\">*</span>shm_fuzz<span class=\"token punctuation\">;</span>\n  <span class=\"token class-name\">afl_env_vars_t</span>   afl_env<span class=\"token punctuation\">;</span>\t\n  <span class=\"token comment\">//...</span>\n<span class=\"token punctuation\">}</span> <span class=\"token class-name\">afl_state_t</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// afl-fuzz-init.c 该函数的目的是使用原始输入执行程序</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">perform_dry_run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">afl_state_t</span> <span class=\"token operator\">*</span>afl<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// afl-forkserver.c </span>\n<span class=\"token comment\">// 该函数用于进行子程序的执行</span>\n<span class=\"token class-name\">fsrv_run_result_t</span> <span class=\"token keyword\">__attribute__</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>hot<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">afl_fsrv_run_target</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">afl_forkserver_t</span> <span class=\"token operator\">*</span>fsrv<span class=\"token punctuation\">,</span> u32 timeout<span class=\"token punctuation\">,</span>\n                    <span class=\"token keyword\">volatile</span> u8 <span class=\"token operator\">*</span>stop_soon_p<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n",
            "tags": [
                "fuzz"
            ]
        }
    ]
}