<?xml version="1.0"?>
<rss version="2.0">
    <channel>
        <title>alazymachine • Posts by &#34;hook&#34; tag</title>
        <link>https://alazymechnaic.github.io</link>
        <description></description>
        <language>zh-CN</language>
        <pubDate>Tue, 03 Oct 2023 19:03:18 +0800</pubDate>
        <lastBuildDate>Tue, 03 Oct 2023 19:03:18 +0800</lastBuildDate>
        <category>paper</category>
        <category>fuzz</category>
        <category>arm</category>
        <category>Linux</category>
        <category>C</category>
        <category>go</category>
        <category>Paper</category>
        <category>bypass</category>
        <category>clash</category>
        <category>Hook</category>
        <category>go, RE</category>
        <category>kernel pwn</category>
        <category>binary</category>
        <category>writing</category>
        <category>HEAP PWN CTF</category>
        <category>Android</category>
        <category>dataflow</category>
        <category>pwn</category>
        <item>
            <guid isPermalink="true">https://alazymechnaic.github.io/2023/10/03/frida-hook/</guid>
            <title>frida-hook</title>
            <link>https://alazymechnaic.github.io/2023/10/03/frida-hook/</link>
            <category>Hook</category>
            <pubDate>Tue, 03 Oct 2023 19:03:18 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;Frida-hook实战&#34;&gt;&lt;a href=&#34;#Frida-hook实战&#34; class=&#34;headerlink&#34; title=&#34;Frida hook实战&#34;&gt;&lt;/a&gt;Frida hook实战&lt;/h1&gt;&lt;hr&gt;
&lt;p&gt;本文记录frida在Windows上的使用过程。代码出处位于参考链接中。&lt;/p&gt;
&lt;h2 id=&#34;安装&#34;&gt;&lt;a href=&#34;#安装&#34; class=&#34;headerlink&#34; title=&#34;安装&#34;&gt;&lt;/a&gt;安装&lt;/h2&gt;&lt;p&gt;安装Python的frida模块：&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs shell&#34;&gt;pip install frida-tools&lt;br&gt;pip install frida&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;首先下载frida的server：&lt;a href=&#34;https://github.com/frida/frida/releases/download/16.1.4/frida-server-16.1.4-android-x86_64.xz&#34;&gt;https://github.com/frida/frida/releases/download/16.1.4/frida-server-16.1.4-android-x86_64.xz&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;安装frida-server&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs shell&#34;&gt;adb push frida-server /data/local/tmp/frida-server&lt;br&gt;adb shell chmod 777 /data/local/tmp/frida-server	&lt;br&gt;&lt;span class=&#34;hljs-meta prompt_&#34;&gt;# &lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt;而后启动&lt;/span&gt;&lt;br&gt;/data/local/tmp/frida-server&lt;br&gt; frida-ps -U # 该指令执行过后能够看到在运行的frida-server&lt;br&gt; frida-ls-devices # 查看当前的设备&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;https://alazymechnaic.oss-cn-hangzhou.aliyuncs.com/blog-page/202310031921608.png&#34; alt=&#34;image-20231003192150554&#34;&gt;&lt;/p&gt;
&lt;p&gt;还需要保证 selinux 是关闭的状态，可以在 adb shell 里，su - 获得 root 权限之后，输入 setenforce 0 命令来获得。&lt;/p&gt;
&lt;h3 id=&#34;adb常用指令&#34;&gt;&lt;a href=&#34;#adb常用指令&#34; class=&#34;headerlink&#34; title=&#34;adb常用指令&#34;&gt;&lt;/a&gt;adb常用指令&lt;/h3&gt;&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs shell&#34;&gt;adb devices # 列出当前已经连接的安卓设备&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;https://alazymechnaic.oss-cn-hangzhou.aliyuncs.com/blog-page/202310031916069.png&#34; alt=&#34;image-20231003191603976&#34;&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs shell&#34;&gt;adb -s &amp;lt;device_id&amp;gt; shell # 这里可以使用adb -s 127.0.0.1:5555 shell 连接&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&#34;Frida-Hook-Native脚本编写&#34;&gt;&lt;a href=&#34;#Frida-Hook-Native脚本编写&#34; class=&#34;headerlink&#34; title=&#34;Frida Hook Native脚本编写&#34;&gt;&lt;/a&gt;Frida Hook Native脚本编写&lt;/h2&gt;&lt;p&gt;脚本运行指令&lt;/p&gt;
&lt;figure class=&#34;highlight powershell&#34;&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs powershell&#34;&gt;frida &lt;span class=&#34;hljs-literal&#34;&gt;-U&lt;/span&gt; &lt;span class=&#34;hljs-operator&#34;&gt;-f&lt;/span&gt; &amp;lt;com.example.x86demo 需要加载的包名&amp;gt; &lt;span class=&#34;hljs-literal&#34;&gt;-l&lt;/span&gt; &amp;lt;hook.js 本次运行的脚本&amp;gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;当然也可以使用python的脚本运行，但是不推荐，看不到js代码中的报错&lt;/p&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs python&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;import&lt;/span&gt; frida&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;import&lt;/span&gt; sys&lt;br&gt;&lt;span class=&#34;hljs-comment&#34;&gt;# 定义目标应用程序的包名和目标函数名&lt;/span&gt;&lt;br&gt;target_package_name = &lt;span class=&#34;hljs-string&#34;&gt;&#39;com.example.x86demo&#39;&lt;/span&gt;&lt;br&gt;target_function_name = &lt;span class=&#34;hljs-string&#34;&gt;&#39;Java_com_example_x86demo_MainActivity_stringFromJNI&#39;&lt;/span&gt; &lt;span class=&#34;hljs-comment&#34;&gt;# 这里注意使用的函数名称一定是以Java为开头的函数&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-comment&#34;&gt;# 创建Frida会话并附加到目标应用程序&lt;/span&gt;&lt;br&gt;device = frida.get_device(&lt;span class=&#34;hljs-string&#34;&gt;&#39;emulator-5554&#39;&lt;/span&gt;)&lt;br&gt;pid = device.spawn([target_package_name])&lt;br&gt;session = device.attach(pid)&lt;br&gt;&lt;span class=&#34;hljs-comment&#34;&gt;# device.resume(pid)&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;hljs-title function_&#34;&gt;on_message&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;message, data&lt;/span&gt;):&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; message[&lt;span class=&#34;hljs-string&#34;&gt;&#39;type&#39;&lt;/span&gt;] == &lt;span class=&#34;hljs-string&#34;&gt;&#39;send&#39;&lt;/span&gt;:&lt;br&gt;        &lt;span class=&#34;hljs-built_in&#34;&gt;print&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;[*] {0}&#34;&lt;/span&gt;.&lt;span class=&#34;hljs-built_in&#34;&gt;format&lt;/span&gt;(message[&lt;span class=&#34;hljs-string&#34;&gt;&#39;payload&#39;&lt;/span&gt;]))&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;:&lt;br&gt;        &lt;span class=&#34;hljs-built_in&#34;&gt;print&lt;/span&gt;(message)&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-comment&#34;&gt;# 创建Native层Hook&lt;/span&gt;&lt;br&gt;script = session.create_script(&lt;span class=&#34;hljs-string&#34;&gt;&#34;&#34;&#34;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;Java.perform(() =&amp;gt; {&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;	// 这里写js脚本&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;})           &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;&#34;&#34;&#34;&lt;/span&gt;)&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-comment&#34;&gt;# 注册Hook回调函数&lt;/span&gt;&lt;br&gt;script.on(&lt;span class=&#34;hljs-string&#34;&gt;&#39;message&#39;&lt;/span&gt;, on_message)&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-comment&#34;&gt;# 加载并运行Hook脚本&lt;/span&gt;&lt;br&gt;script.load()&lt;br&gt;&lt;span class=&#34;hljs-comment&#34;&gt;# 保持脚本运行&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-built_in&#34;&gt;input&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;Press any key to exit...&#34;&lt;/span&gt;)&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;获取so基地址&#34;&gt;&lt;a href=&#34;#获取so基地址&#34; class=&#34;headerlink&#34; title=&#34;获取so基地址&#34;&gt;&lt;/a&gt;获取so基地址&lt;/h3&gt;&lt;figure class=&#34;highlight js&#34;&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs js&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title function_&#34;&gt;hookBaseAddress&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;) {&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; address = &lt;span class=&#34;hljs-title class_&#34;&gt;Module&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;findBaseAddress&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;libnative-lib.so&#34;&lt;/span&gt;);&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (address) {&lt;br&gt;        &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(address); &lt;span class=&#34;hljs-comment&#34;&gt;//这里我获取到的是 0xb8f91000&lt;/span&gt;&lt;br&gt;    }&lt;br&gt;}&lt;br&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;h3 id=&#34;查看native层内容&#34;&gt;&lt;a href=&#34;#查看native层内容&#34; class=&#34;headerlink&#34; title=&#34;查看native层内容&#34;&gt;&lt;/a&gt;查看native层内容&lt;/h3&gt;&lt;figure class=&#34;highlight js&#34;&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs js&#34;&gt;&lt;span class=&#34;hljs-comment&#34;&gt;// 枚举native层函数&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title function_&#34;&gt;hookImEx&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;) {&lt;br&gt;    &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;以下是导入函数：&#34;&lt;/span&gt;);&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; importMethods = &lt;span class=&#34;hljs-title class_&#34;&gt;Module&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;enumerateImports&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;libnative-lib.so&#34;&lt;/span&gt;);&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;let&lt;/span&gt; index = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; index &amp;lt; importMethods.&lt;span class=&#34;hljs-property&#34;&gt;length&lt;/span&gt;; index++) {&lt;br&gt;        &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; element = importMethods[index];&lt;br&gt;        &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-title class_&#34;&gt;JSON&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;stringify&lt;/span&gt;(element));&lt;br&gt;    }&lt;br&gt;&lt;br&gt;    &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;以下是导出函数：&#34;&lt;/span&gt;);&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; exportMethods = &lt;span class=&#34;hljs-title class_&#34;&gt;Module&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;enumerateExports&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;libnative-lib.so&#34;&lt;/span&gt;);&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;hljs-keyword&#34;&gt;let&lt;/span&gt; index = &lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;; index &amp;lt; exportMethods.&lt;span class=&#34;hljs-property&#34;&gt;length&lt;/span&gt;; index++) {&lt;br&gt;        &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; element = exportMethods[index];&lt;br&gt;        &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-title class_&#34;&gt;JSON&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;stringify&lt;/span&gt;(element));&lt;br&gt;    }&lt;br&gt;}&lt;br&gt;&lt;span class=&#34;hljs-comment&#34;&gt;// 查看native层的调用结果&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title function_&#34;&gt;hookByName&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;) {&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; address = &lt;span class=&#34;hljs-title class_&#34;&gt;Module&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;findExportByName&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;libnative-lib.so&#34;&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&#34;Java_com_zyc_fridasodemo_Calc_addThreeNum&#34;&lt;/span&gt;);&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (address) {&lt;br&gt;        &lt;span class=&#34;hljs-title class_&#34;&gt;Interceptor&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;attach&lt;/span&gt;(address, {&lt;br&gt;            &lt;span class=&#34;hljs-title function_&#34;&gt;onEnter&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;args&lt;/span&gt;) {&lt;br&gt;                &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;onEnter...&#34;&lt;/span&gt;);&lt;br&gt;                &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;args[0]:&#34;&lt;/span&gt;,args[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;]);&lt;br&gt;                &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;args[1]:&#34;&lt;/span&gt;,args[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;]);&lt;br&gt;                &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;args[2]：&#34;&lt;/span&gt;,args[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;]);&lt;br&gt;                &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;args[3]：&#34;&lt;/span&gt;,args[&lt;span class=&#34;hljs-number&#34;&gt;3&lt;/span&gt;]);&lt;br&gt;                &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;args[4]：&#34;&lt;/span&gt;,args[&lt;span class=&#34;hljs-number&#34;&gt;4&lt;/span&gt;]);&lt;br&gt;            },&lt;br&gt;            &lt;span class=&#34;hljs-title function_&#34;&gt;onLeave&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;retval&lt;/span&gt;) { &lt;br&gt;                &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;onLeave...&#34;&lt;/span&gt;);&lt;br&gt;                &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;retval:&#34;&lt;/span&gt;,retval); &lt;span class=&#34;hljs-comment&#34;&gt;// 函数返回值&lt;/span&gt;&lt;br&gt;            }&lt;br&gt;        });&lt;br&gt;    }&lt;br&gt;}&lt;br&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;修改native层的参数&#34;&gt;&lt;a href=&#34;#修改native层的参数&#34; class=&#34;headerlink&#34; title=&#34;修改native层的参数&#34;&gt;&lt;/a&gt;修改native层的参数&lt;/h3&gt;&lt;figure class=&#34;highlight js&#34;&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs js&#34;&gt;&lt;span class=&#34;hljs-comment&#34;&gt;// 修改native层的内容&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-comment&#34;&gt;// 根据上面获取的 args 我们可以修改参数，但注意参数得是 NativePointer，直接用 “=” 赋值会报错“expected a pointer”&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title function_&#34;&gt;hookParam&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;){&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; address = &lt;span class=&#34;hljs-title class_&#34;&gt;Module&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;findExportByName&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;libnative-lib.so&#34;&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&#34;Java_com_zyc_fridasodemo_Calc_addThreeNum&#34;&lt;/span&gt;);&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (address) {&lt;br&gt;        &lt;span class=&#34;hljs-title class_&#34;&gt;Interceptor&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;attach&lt;/span&gt;(address, {&lt;br&gt;            &lt;span class=&#34;hljs-title function_&#34;&gt;onEnter&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;args&lt;/span&gt;) {&lt;br&gt;                args[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;] = &lt;span class=&#34;hljs-title function_&#34;&gt;ptr&lt;/span&gt;(&lt;span class=&#34;hljs-number&#34;&gt;1000&lt;/span&gt;); &lt;span class=&#34;hljs-comment&#34;&gt;// 写成 args[2]=1000 会报错&lt;/span&gt;&lt;br&gt;            },&lt;br&gt;            &lt;span class=&#34;hljs-title function_&#34;&gt;onLeave&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;retval&lt;/span&gt;) {}&lt;br&gt;        });&lt;br&gt;    }&lt;br&gt;}&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;h3 id=&#34;修改native层函数的返回值&#34;&gt;&lt;a href=&#34;#修改native层函数的返回值&#34; class=&#34;headerlink&#34; title=&#34;修改native层函数的返回值&#34;&gt;&lt;/a&gt;修改native层函数的返回值&lt;/h3&gt;&lt;figure class=&#34;highlight js&#34;&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs js&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title function_&#34;&gt;hookReturn&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;){&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; address = &lt;span class=&#34;hljs-title class_&#34;&gt;Module&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;findExportByName&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;libnative-lib.so&#34;&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&#34;Java_com_zyc_fridasodemo_Calc_addThreeNum&#34;&lt;/span&gt;);&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (address) {&lt;br&gt;        &lt;span class=&#34;hljs-title class_&#34;&gt;Interceptor&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;attach&lt;/span&gt;(address, {&lt;br&gt;            &lt;span class=&#34;hljs-title function_&#34;&gt;onEnter&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;args&lt;/span&gt;) {},&lt;br&gt;            &lt;span class=&#34;hljs-title function_&#34;&gt;onLeave&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;retval&lt;/span&gt;) {&lt;br&gt;                retval.&lt;span class=&#34;hljs-title function_&#34;&gt;replace&lt;/span&gt;(&lt;span class=&#34;hljs-number&#34;&gt;32&lt;/span&gt;); &lt;span class=&#34;hljs-comment&#34;&gt;//用 replace() 不要用 =&lt;/span&gt;&lt;br&gt;                &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;retval:&#34;&lt;/span&gt;,retval);&lt;br&gt;                &lt;span class=&#34;hljs-comment&#34;&gt;// 如果返回值是jstring，得用下面方式替换&lt;/span&gt;&lt;br&gt;               &lt;span class=&#34;hljs-comment&#34;&gt;//var env = Java.vm.getEnv(); //获取env对象，即第一个参数&lt;/span&gt;&lt;br&gt;               &lt;span class=&#34;hljs-comment&#34;&gt;//var jstrings = env.newStringUtf(&#34;xxxx&#34;); //返回的是字符串指针，使用jni函数构造一个newStringUtf对象用来代替这个指针&lt;/span&gt;&lt;br&gt;               &lt;span class=&#34;hljs-comment&#34;&gt;//retval.replace(jstrings); &lt;/span&gt;&lt;br&gt;            }&lt;br&gt;        });&lt;br&gt;    }&lt;br&gt;}&lt;br&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;Hook未导出的函数&#34;&gt;&lt;a href=&#34;#Hook未导出的函数&#34; class=&#34;headerlink&#34; title=&#34;Hook未导出的函数&#34;&gt;&lt;/a&gt;Hook未导出的函数&lt;/h3&gt;&lt;figure class=&#34;highlight js&#34;&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs js&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title function_&#34;&gt;hookDynamic&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;) {&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; soAddress = &lt;span class=&#34;hljs-title class_&#34;&gt;Module&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;findBaseAddress&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;libnative-lib.so&#34;&lt;/span&gt;);&lt;br&gt;    &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;so基址：&#34;&lt;/span&gt; + soAddress);&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (soAddress) {&lt;br&gt;        &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; methodAddress = soAddress.&lt;span class=&#34;hljs-title function_&#34;&gt;add&lt;/span&gt;(&lt;span class=&#34;hljs-number&#34;&gt;0x0690&lt;/span&gt;); &lt;span class=&#34;hljs-comment&#34;&gt;// thrumb指令集要+1&lt;/span&gt;&lt;br&gt;        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (methodAddress) {&lt;br&gt;            &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;函数地址：&#34;&lt;/span&gt; + methodAddress);&lt;br&gt;            &lt;span class=&#34;hljs-title class_&#34;&gt;Interceptor&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;attach&lt;/span&gt;(methodAddress, {&lt;br&gt;                &lt;span class=&#34;hljs-title function_&#34;&gt;onEnter&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;args&lt;/span&gt;) {&lt;br&gt;                    &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;hook动态注册函数的参数：&#34;&lt;/span&gt; + &lt;span class=&#34;hljs-title class_&#34;&gt;Java&lt;/span&gt;.&lt;span class=&#34;hljs-property&#34;&gt;vm&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;getEnv&lt;/span&gt;().&lt;span class=&#34;hljs-title function_&#34;&gt;getStringUtfChars&lt;/span&gt;(args[&lt;span class=&#34;hljs-number&#34;&gt;2&lt;/span&gt;], &lt;span class=&#34;hljs-literal&#34;&gt;null&lt;/span&gt;).&lt;span class=&#34;hljs-title function_&#34;&gt;readCString&lt;/span&gt;()); &lt;span class=&#34;hljs-comment&#34;&gt;//打印jstring要用getStringUtfChars&lt;/span&gt;&lt;br&gt;                },&lt;br&gt;                &lt;span class=&#34;hljs-title function_&#34;&gt;onLeave&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;retval&lt;/span&gt;) {&lt;br&gt;                    &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;hook动态注册函数的返回值：&#34;&lt;/span&gt; + &lt;span class=&#34;hljs-title class_&#34;&gt;Java&lt;/span&gt;.&lt;span class=&#34;hljs-property&#34;&gt;vm&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;getEnv&lt;/span&gt;().&lt;span class=&#34;hljs-title function_&#34;&gt;getStringUtfChars&lt;/span&gt;(retval, &lt;span class=&#34;hljs-literal&#34;&gt;null&lt;/span&gt;).&lt;span class=&#34;hljs-title function_&#34;&gt;readCString&lt;/span&gt;());&lt;br&gt;                }&lt;br&gt;            });&lt;br&gt;        }&lt;br&gt;    }&lt;br&gt;}&lt;br&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;Hook-so加载（dlopen）&#34;&gt;&lt;a href=&#34;#Hook-so加载（dlopen）&#34; class=&#34;headerlink&#34; title=&#34;Hook so加载（dlopen）&#34;&gt;&lt;/a&gt;Hook so加载（dlopen）&lt;/h3&gt;&lt;figure class=&#34;highlight js&#34;&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs js&#34;&gt;&lt;span class=&#34;hljs-comment&#34;&gt;// 当遇到“等so加载完后进行某Hook操作时”，可以Hook dlopen（有的是android_dlopen_ext）方法来确定so的加载。PS：不推荐Hook System.loadLibrary()，因为加载so的方式并不止这一种，而且最终都会调用 dlopen()&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title function_&#34;&gt;hookDlopen&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;) {&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;let&lt;/span&gt; dlopenAddr = &lt;span class=&#34;hljs-title class_&#34;&gt;Module&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;findExportByName&lt;/span&gt;(&lt;span class=&#34;hljs-literal&#34;&gt;null&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&#34;dlopen&#34;&lt;/span&gt;);&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (dlopenAddr) {&lt;br&gt;        &lt;span class=&#34;hljs-title class_&#34;&gt;Interceptor&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;attach&lt;/span&gt;(dlopenAddr, {&lt;br&gt;            &lt;span class=&#34;hljs-title function_&#34;&gt;onEnter&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;args&lt;/span&gt;) { &lt;span class=&#34;hljs-comment&#34;&gt;// dlopen(const char* filename, int flags)&lt;/span&gt;&lt;br&gt;                &lt;span class=&#34;hljs-keyword&#34;&gt;let&lt;/span&gt; soName = args[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;].&lt;span class=&#34;hljs-title function_&#34;&gt;readCString&lt;/span&gt;(); &lt;span class=&#34;hljs-comment&#34;&gt;// &#34;/data/app/com.zyc.fridasodemo-1/lib/x86/libnative-lib.so&#34;&lt;/span&gt;&lt;br&gt;                &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (soName.&lt;span class=&#34;hljs-title function_&#34;&gt;indexOf&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;libnative-lib.so&#34;&lt;/span&gt;) != -&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;) {&lt;br&gt;                    &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;成功加载到了--&amp;gt;&#34;&lt;/span&gt; + soName);&lt;br&gt;                    &lt;span class=&#34;hljs-variable language_&#34;&gt;this&lt;/span&gt;.&lt;span class=&#34;hljs-property&#34;&gt;hasloaded&lt;/span&gt; = &lt;span class=&#34;hljs-literal&#34;&gt;true&lt;/span&gt;;&lt;br&gt;                }&lt;br&gt;            },&lt;br&gt;            &lt;span class=&#34;hljs-title function_&#34;&gt;onLeave&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;retval&lt;/span&gt;) { &lt;span class=&#34;hljs-comment&#34;&gt;//onLeave()中才是dlopen()加载完成后&lt;/span&gt;&lt;br&gt;                &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;hljs-variable language_&#34;&gt;this&lt;/span&gt;.&lt;span class=&#34;hljs-property&#34;&gt;hasloaded&lt;/span&gt;) {&lt;br&gt;                    &lt;span class=&#34;hljs-title function_&#34;&gt;hooImEx&lt;/span&gt;(); &lt;span class=&#34;hljs-comment&#34;&gt;// 等so加载完成就执行导入/导出函数打印&lt;/span&gt;&lt;br&gt;                }&lt;br&gt;            }&lt;br&gt;        });&lt;br&gt;    }&lt;br&gt;}&lt;br&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;读写内存&#34;&gt;&lt;a href=&#34;#读写内存&#34; class=&#34;headerlink&#34; title=&#34;读写内存&#34;&gt;&lt;/a&gt;读写内存&lt;/h3&gt;&lt;figure class=&#34;highlight js&#34;&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs js&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title function_&#34;&gt;hookMem&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;) {&lt;br&gt;        &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; soAddress = &lt;span class=&#34;hljs-title class_&#34;&gt;Module&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;findBaseAddress&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;libnative-lib.so&#34;&lt;/span&gt;);&lt;br&gt;        &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;so基址：&#34;&lt;/span&gt; + soAddress);&lt;br&gt;        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (soAddress) {&lt;br&gt;            &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;读取...&#34;&lt;/span&gt;);&lt;br&gt;            &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; strAddress = soAddress.&lt;span class=&#34;hljs-title function_&#34;&gt;add&lt;/span&gt;(&lt;span class=&#34;hljs-number&#34;&gt;0x028334&lt;/span&gt;);&lt;br&gt;            &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;打印这段字符串：&#34;&lt;/span&gt; + strAddress.&lt;span class=&#34;hljs-title function_&#34;&gt;readCString&lt;/span&gt;());&lt;br&gt;            &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;读16字节：&#34;&lt;/span&gt;);&lt;br&gt;            &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(strAddress.&lt;span class=&#34;hljs-title function_&#34;&gt;readByteArray&lt;/span&gt;(&lt;span class=&#34;hljs-number&#34;&gt;16&lt;/span&gt;));&lt;br&gt;    &lt;br&gt;            &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;写入...&#34;&lt;/span&gt;);&lt;br&gt;            &lt;span class=&#34;hljs-title class_&#34;&gt;Memory&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;protect&lt;/span&gt;(strAddress, &lt;span class=&#34;hljs-title class_&#34;&gt;Process&lt;/span&gt;.&lt;span class=&#34;hljs-property&#34;&gt;pageSize&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&#34;rw-&#34;&lt;/span&gt;); &lt;span class=&#34;hljs-comment&#34;&gt;//修改内存页属性后再写入，不然可能报access violation accessing&lt;/span&gt;&lt;br&gt;            strAddress.&lt;span class=&#34;hljs-title function_&#34;&gt;writeUtf8String&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;Hello from PHP&#34;&lt;/span&gt;) &lt;span class=&#34;hljs-comment&#34;&gt;//内存写入字符串,该方法末尾会自动添加&#39;\0&#39;&lt;/span&gt;&lt;br&gt;            &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;\r\n打印这段字符串：&#34;&lt;/span&gt; + strAddress.&lt;span class=&#34;hljs-title function_&#34;&gt;readCString&lt;/span&gt;());&lt;br&gt;            &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;读16字节：\r\n&#34;&lt;/span&gt;);&lt;br&gt;            &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(strAddress.&lt;span class=&#34;hljs-title function_&#34;&gt;readByteArray&lt;/span&gt;(&lt;span class=&#34;hljs-number&#34;&gt;16&lt;/span&gt;));&lt;br&gt;        }&lt;br&gt;    }&lt;br&gt;    &lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;一个例子&#34;&gt;&lt;a href=&#34;#一个例子&#34; class=&#34;headerlink&#34; title=&#34;一个例子&#34;&gt;&lt;/a&gt;一个例子&lt;/h3&gt;&lt;h4 id=&#34;题目描述&#34;&gt;&lt;a href=&#34;#题目描述&#34; class=&#34;headerlink&#34; title=&#34;题目描述&#34;&gt;&lt;/a&gt;题目描述&lt;/h4&gt;&lt;p&gt;很简单的一个app，打开会显示Hello from C++，题目的要求是修改该字符串为任意值。看起来挺容易&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://alazymechnaic.oss-cn-hangzhou.aliyuncs.com/blog-page/image-20231004222425282.png&#34; alt=&#34;image-20231004222425282&#34;&gt;&lt;/p&gt;
&lt;p&gt;使用jeb逆向看一下MainActivity的逻辑：字符串生成函数来自native层的stringFromJNI，这里的第一想法是使用frida 在native做hook。&lt;br&gt;&lt;img src=&#34;https://alazymechnaic.oss-cn-hangzhou.aliyuncs.com/blog-page/image-20231004222542793.png&#34; alt=&#34;image-20231004222542793&#34;&gt;&lt;/p&gt;
&lt;p&gt;导出libnative-lib.so文件，IDA pro 7.5还是蛮强大的，老版本的IDA是不认识JNI函数的。在export找到对应的函数：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://alazymechnaic.oss-cn-hangzhou.aliyuncs.com/blog-page/image-20231004222937267.png&#34; alt=&#34;image-20231004222937267&#34;&gt;&lt;/p&gt;
&lt;p&gt;逻辑很简单&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://alazymechnaic.oss-cn-hangzhou.aliyuncs.com/blog-page/image-20231004222953301.png&#34; alt=&#34;image-20231004222953301&#34;&gt;&lt;/p&gt;
&lt;p&gt;第一次使用的脚本如下：&lt;/p&gt;
&lt;figure class=&#34;highlight js&#34;&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs js&#34;&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title function_&#34;&gt;hookByName&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;) {&lt;br&gt;        &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; address = &lt;span class=&#34;hljs-title class_&#34;&gt;Module&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;findExportByName&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;libnative-lib.so&#34;&lt;/span&gt;,&lt;span class=&#34;hljs-string&#34;&gt;&#34;Java_com_example_x86demo_MainActivity_stringFromJNI&#34;&lt;/span&gt;);&lt;br&gt;        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (address) {&lt;br&gt;            &lt;span class=&#34;hljs-title class_&#34;&gt;Interceptor&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;attach&lt;/span&gt;(address, {&lt;br&gt;                &lt;span class=&#34;hljs-title function_&#34;&gt;onEnter&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;args&lt;/span&gt;) {&lt;br&gt;                    &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;onEnter...&#34;&lt;/span&gt;);&lt;br&gt;                },&lt;br&gt;                &lt;span class=&#34;hljs-title function_&#34;&gt;onLeave&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;retval&lt;/span&gt;) { &lt;br&gt;                    &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;onLeave...&#34;&lt;/span&gt;);&lt;br&gt;                    &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; env = &lt;span class=&#34;hljs-title class_&#34;&gt;Java&lt;/span&gt;.&lt;span class=&#34;hljs-property&#34;&gt;vm&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;getEnv&lt;/span&gt;();&lt;br&gt;                    &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; jstrings = env.&lt;span class=&#34;hljs-title function_&#34;&gt;newStringUtf&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;Hacked!&#34;&lt;/span&gt;);&lt;br&gt;                    retval.&lt;span class=&#34;hljs-title function_&#34;&gt;replace&lt;/span&gt;(jstrings);&lt;br&gt;                    &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;retval:&#34;&lt;/span&gt;,retval); &lt;span class=&#34;hljs-comment&#34;&gt;// 函数返回值&lt;/span&gt;&lt;br&gt;                }&lt;br&gt;            });&lt;br&gt;        }&lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;{&lt;br&gt;            &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;NOT FOUND!&#34;&lt;/span&gt;);&lt;br&gt;        }&lt;br&gt;    }&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;​	但是frida一直是NOT FOUND，这是因为frida要重启APP去执行该脚本，在onCreate函数执行前libnative-lib.so还没有加载，因此在程序内存中是找不到该so文件的。因此有两种方法，一种是使用dlopen手动加载该so，但是程序直接崩溃了。。。。&lt;/p&gt;
&lt;p&gt;​	另一种方法是hook onCreate函数，在onCreate函数执行之前执行native的hook，当然这里so文件已经加载进内存了，stringFromJNI中的字符串是硬编码存储，也可以直接修改内存。要注意以下几点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;hook native&lt;/strong&gt;&lt;ul&gt;
&lt;li&gt;在对native函数进行hook的时候要使用函数的全名。打开IDA后Export显示的名称&lt;/li&gt;
&lt;li&gt;修改返回值时，如果返回值是string，不能简单的replace（具体方式看下面脚本）&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;修改内存&lt;/strong&gt;&lt;ul&gt;
&lt;li&gt;修改内存先找so基址，偏移量将IDA segment中的base addr设为0后，显示的地址加so基址即可&lt;/li&gt;
&lt;li&gt;写内容时先修改内存页的保护属性&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;具体脚本如下：&lt;/p&gt;
&lt;h4 id=&#34;解题脚本&#34;&gt;&lt;a href=&#34;#解题脚本&#34; class=&#34;headerlink&#34; title=&#34;解题脚本&#34;&gt;&lt;/a&gt;解题脚本&lt;/h4&gt;&lt;figure class=&#34;highlight js&#34;&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;54&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs js&#34;&gt;&lt;span class=&#34;hljs-title class_&#34;&gt;Java&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;perform&lt;/span&gt;(&lt;span class=&#34;hljs-function&#34;&gt;() =&amp;gt;&lt;/span&gt; {&lt;br&gt;&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title function_&#34;&gt;hookMem&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;) {&lt;br&gt;        &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; soAddress = &lt;span class=&#34;hljs-title class_&#34;&gt;Module&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;findBaseAddress&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;libnative-lib.so&#34;&lt;/span&gt;);&lt;br&gt;        &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;so基址：&#34;&lt;/span&gt; + soAddress);&lt;br&gt;        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (soAddress) {&lt;br&gt;            &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;读取...&#34;&lt;/span&gt;);&lt;br&gt;            &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; strAddress = soAddress.&lt;span class=&#34;hljs-title function_&#34;&gt;add&lt;/span&gt;(&lt;span class=&#34;hljs-number&#34;&gt;0x028334&lt;/span&gt;);&lt;br&gt;            &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;打印这段字符串：&#34;&lt;/span&gt; + strAddress.&lt;span class=&#34;hljs-title function_&#34;&gt;readCString&lt;/span&gt;());&lt;br&gt;            &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;读16字节：&#34;&lt;/span&gt;);&lt;br&gt;            &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(strAddress.&lt;span class=&#34;hljs-title function_&#34;&gt;readByteArray&lt;/span&gt;(&lt;span class=&#34;hljs-number&#34;&gt;16&lt;/span&gt;));&lt;br&gt;    &lt;br&gt;            &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;写入...&#34;&lt;/span&gt;);&lt;br&gt;            &lt;span class=&#34;hljs-title class_&#34;&gt;Memory&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;protect&lt;/span&gt;(strAddress, &lt;span class=&#34;hljs-title class_&#34;&gt;Process&lt;/span&gt;.&lt;span class=&#34;hljs-property&#34;&gt;pageSize&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&#34;rw-&#34;&lt;/span&gt;); &lt;span class=&#34;hljs-comment&#34;&gt;//修改内存页属性后再写入&lt;/span&gt;&lt;br&gt;            strAddress.&lt;span class=&#34;hljs-title function_&#34;&gt;writeUtf8String&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;x86demo Hacked&#34;&lt;/span&gt;) &lt;span class=&#34;hljs-comment&#34;&gt;//内存写入字符串,该方法末尾会自动添加&#39;\0&#39;&lt;/span&gt;&lt;br&gt;            &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;\r\n打印这段字符串：&#34;&lt;/span&gt; + strAddress.&lt;span class=&#34;hljs-title function_&#34;&gt;readCString&lt;/span&gt;());&lt;br&gt;            &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;读16字节：\r\n&#34;&lt;/span&gt;);&lt;br&gt;            &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(strAddress.&lt;span class=&#34;hljs-title function_&#34;&gt;readByteArray&lt;/span&gt;(&lt;span class=&#34;hljs-number&#34;&gt;16&lt;/span&gt;));&lt;br&gt;        }&lt;br&gt;    }&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; clazz = &lt;span class=&#34;hljs-title class_&#34;&gt;Java&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;use&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;com.example.x86demo.MainActivity&#34;&lt;/span&gt;);&lt;br&gt;    clazz.&lt;span class=&#34;hljs-property&#34;&gt;onCreate&lt;/span&gt;.&lt;span class=&#34;hljs-property&#34;&gt;implementation&lt;/span&gt; = &lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;)&lt;br&gt;    {&lt;br&gt;        &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;Hook MainActivity onCreate()...&#34;&lt;/span&gt;);&lt;br&gt;        &lt;span class=&#34;hljs-comment&#34;&gt;// hookMem();&lt;/span&gt;&lt;br&gt;        &lt;span class=&#34;hljs-title function_&#34;&gt;hookByName&lt;/span&gt;();&lt;br&gt;        &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-variable language_&#34;&gt;this&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;onCreate&lt;/span&gt;(&lt;span class=&#34;hljs-variable language_&#34;&gt;arguments&lt;/span&gt;[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;]);&lt;br&gt;    }&lt;br&gt;    &lt;br&gt;&lt;br&gt;&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;hljs-title function_&#34;&gt;hookByName&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;) {&lt;br&gt;        &lt;span class=&#34;hljs-keyword&#34;&gt;const&lt;/span&gt; address = &lt;span class=&#34;hljs-title class_&#34;&gt;Module&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;findExportByName&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;libnative-lib.so&#34;&lt;/span&gt;,&lt;span class=&#34;hljs-string&#34;&gt;&#34;Java_com_example_x86demo_MainActivity_stringFromJNI&#34;&lt;/span&gt;);&lt;br&gt;        &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; (address) {&lt;br&gt;            &lt;span class=&#34;hljs-title class_&#34;&gt;Interceptor&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;attach&lt;/span&gt;(address, {&lt;br&gt;                &lt;span class=&#34;hljs-title function_&#34;&gt;onEnter&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;args&lt;/span&gt;) {&lt;br&gt;                    &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;onEnter...&#34;&lt;/span&gt;);&lt;br&gt;                },&lt;br&gt;                &lt;span class=&#34;hljs-title function_&#34;&gt;onLeave&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;retval&lt;/span&gt;) { &lt;br&gt;                    &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;onLeave...&#34;&lt;/span&gt;);&lt;br&gt;                    &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; env = &lt;span class=&#34;hljs-title class_&#34;&gt;Java&lt;/span&gt;.&lt;span class=&#34;hljs-property&#34;&gt;vm&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;getEnv&lt;/span&gt;();&lt;br&gt;                    &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; jstrings = env.&lt;span class=&#34;hljs-title function_&#34;&gt;newStringUtf&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;Hacked!&#34;&lt;/span&gt;);&lt;br&gt;                    retval.&lt;span class=&#34;hljs-title function_&#34;&gt;replace&lt;/span&gt;(jstrings);&lt;br&gt;                    &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;retval:&#34;&lt;/span&gt;,retval); &lt;span class=&#34;hljs-comment&#34;&gt;// 函数返回值&lt;/span&gt;&lt;br&gt;                }&lt;br&gt;            });&lt;br&gt;        }&lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;{&lt;br&gt;            &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;NOt FOUND!&#34;&lt;/span&gt;);&lt;br&gt;        }&lt;br&gt;    }&lt;br&gt;    &lt;br&gt;})&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;最终效果如下：&lt;/p&gt;
&lt;img src=&#34;https://alazymechnaic.oss-cn-hangzhou.aliyuncs.com/blog-page/image-20231004224219956.png&#34; alt=&#34;image-20231004224219956&#34; style=&#34;zoom: 80%;&#34;&gt;

&lt;h2 id=&#34;Frida-Hook-Java层函数&#34;&gt;&lt;a href=&#34;#Frida-Hook-Java层函数&#34; class=&#34;headerlink&#34; title=&#34;Frida Hook Java层函数&#34;&gt;&lt;/a&gt;Frida Hook Java层函数&lt;/h2&gt;&lt;h3 id=&#34;Hook一般java层函数&#34;&gt;&lt;a href=&#34;#Hook一般java层函数&#34; class=&#34;headerlink&#34; title=&#34;Hook一般java层函数&#34;&gt;&lt;/a&gt;Hook一般java层函数&lt;/h3&gt;&lt;figure class=&#34;highlight js&#34;&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs js&#34;&gt;&lt;span class=&#34;hljs-title class_&#34;&gt;Java&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;perform&lt;/span&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;){&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; clazz = &lt;span class=&#34;hljs-title class_&#34;&gt;Java&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;use&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;com.zyc.fridademo.Calc&#34;&lt;/span&gt;);&lt;br&gt;    clazz.&lt;span class=&#34;hljs-property&#34;&gt;add&lt;/span&gt;.&lt;span class=&#34;hljs-property&#34;&gt;implementation&lt;/span&gt; = &lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;p1&lt;/span&gt;)&lt;br&gt;    {&lt;br&gt;        &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;Hook开始...&#34;&lt;/span&gt;);&lt;br&gt;        &lt;span class=&#34;hljs-title function_&#34;&gt;send&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;原p1=&#34;&lt;/span&gt;+p1);&lt;br&gt;        &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;Hook修改参数...&#34;&lt;/span&gt;);&lt;br&gt;        p1+=&lt;span class=&#34;hljs-number&#34;&gt;100&lt;/span&gt;;&lt;br&gt;        &lt;span class=&#34;hljs-title function_&#34;&gt;send&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;现p1=&#34;&lt;/span&gt;+p1);&lt;br&gt;        &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-variable language_&#34;&gt;this&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;add&lt;/span&gt;(p1);&lt;br&gt;    }&lt;br&gt;});&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;Hook构造函数&#34;&gt;&lt;a href=&#34;#Hook构造函数&#34; class=&#34;headerlink&#34; title=&#34;Hook构造函数&#34;&gt;&lt;/a&gt;Hook构造函数&lt;/h3&gt;&lt;figure class=&#34;highlight js&#34;&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs js&#34;&gt;&lt;span class=&#34;hljs-title class_&#34;&gt;Java&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;perform&lt;/span&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;){&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; clazz = &lt;span class=&#34;hljs-title class_&#34;&gt;Java&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;use&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;com.zyc.fridademo.Calc&#34;&lt;/span&gt;);&lt;br&gt;    clazz.&lt;span class=&#34;hljs-property&#34;&gt;$init&lt;/span&gt;.&lt;span class=&#34;hljs-property&#34;&gt;implementation&lt;/span&gt; = &lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;p1&lt;/span&gt;)&lt;br&gt;    {&lt;br&gt;        &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;Hook构造开始...&#34;&lt;/span&gt;);&lt;br&gt;        &lt;span class=&#34;hljs-title function_&#34;&gt;send&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;原p1=&#34;&lt;/span&gt;+p1);&lt;br&gt;        p1+=&lt;span class=&#34;hljs-number&#34;&gt;200&lt;/span&gt;;&lt;br&gt;        &lt;span class=&#34;hljs-title function_&#34;&gt;send&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;现p1=&#34;&lt;/span&gt;+p1);&lt;br&gt;        &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-variable language_&#34;&gt;this&lt;/span&gt;.$init(p1);&lt;br&gt;    }&lt;br&gt;});&lt;br&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;Hook重载函数&#34;&gt;&lt;a href=&#34;#Hook重载函数&#34; class=&#34;headerlink&#34; title=&#34;Hook重载函数&#34;&gt;&lt;/a&gt;Hook重载函数&lt;/h3&gt;&lt;figure class=&#34;highlight js&#34;&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs js&#34;&gt;&lt;span class=&#34;hljs-comment&#34;&gt;// 由于Calc中有add(int num1)和add(int num1,String num2)，像普通函数那样Hook是会报错的，涉及到重载就要用到 overload() ：&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-comment&#34;&gt;// 这里按照传入的参数类型区分二者的差异&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-title class_&#34;&gt;Java&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;perform&lt;/span&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;){&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; clazz = &lt;span class=&#34;hljs-title class_&#34;&gt;Java&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;use&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;com.zyc.fridademo.Calc&#34;&lt;/span&gt;);&lt;br&gt;    clazz.&lt;span class=&#34;hljs-property&#34;&gt;add&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;overload&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;int&#34;&lt;/span&gt;).&lt;span class=&#34;hljs-property&#34;&gt;implementation&lt;/span&gt; = &lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;)&lt;br&gt;    {&lt;br&gt;        &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;Hook add(int num1)...&#34;&lt;/span&gt;);&lt;br&gt;        &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;888&lt;/span&gt;;&lt;br&gt;    }&lt;br&gt;&lt;br&gt;    clazz.&lt;span class=&#34;hljs-property&#34;&gt;add&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;overload&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;int&#34;&lt;/span&gt;,&lt;span class=&#34;hljs-string&#34;&gt;&#34;java.lang.String&#34;&lt;/span&gt;).&lt;span class=&#34;hljs-property&#34;&gt;implementation&lt;/span&gt; = &lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;)&lt;br&gt;    {&lt;br&gt;        &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;Hook add(int num1,String num2)...&#34;&lt;/span&gt;);&lt;br&gt;        &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-number&#34;&gt;999&lt;/span&gt;;&lt;br&gt;    }&lt;br&gt;});&lt;br&gt;&lt;span class=&#34;hljs-comment&#34;&gt;// 也可以通过遍历重载函数的形似	&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-title class_&#34;&gt;Java&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;perform&lt;/span&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;){&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; clazz = &lt;span class=&#34;hljs-title class_&#34;&gt;Java&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;use&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;com.zyc.fridademo.Calc&#34;&lt;/span&gt;);&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; count = clazz.&lt;span class=&#34;hljs-property&#34;&gt;add&lt;/span&gt;.&lt;span class=&#34;hljs-property&#34;&gt;overloads&lt;/span&gt;.&lt;span class=&#34;hljs-property&#34;&gt;length&lt;/span&gt;;&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; i=&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;i&amp;lt;count;i++){&lt;br&gt;        clazz.&lt;span class=&#34;hljs-property&#34;&gt;add&lt;/span&gt;.&lt;span class=&#34;hljs-property&#34;&gt;overloads&lt;/span&gt;[i].&lt;span class=&#34;hljs-property&#34;&gt;implementation&lt;/span&gt; = &lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;){&lt;br&gt;            &lt;span class=&#34;hljs-variable language_&#34;&gt;arguments&lt;/span&gt;[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;] = &lt;span class=&#34;hljs-number&#34;&gt;8&lt;/span&gt;;&lt;br&gt;            &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt;(&lt;span class=&#34;hljs-variable language_&#34;&gt;arguments&lt;/span&gt;[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;]){&lt;br&gt;                &lt;span class=&#34;hljs-title function_&#34;&gt;send&lt;/span&gt;(&lt;span class=&#34;hljs-variable language_&#34;&gt;arguments&lt;/span&gt;[&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;]);&lt;br&gt;            }&lt;br&gt;            &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-variable language_&#34;&gt;this&lt;/span&gt;.&lt;span class=&#34;hljs-property&#34;&gt;add&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;apply&lt;/span&gt;(&lt;span class=&#34;hljs-variable language_&#34;&gt;this&lt;/span&gt;,&lt;span class=&#34;hljs-variable language_&#34;&gt;arguments&lt;/span&gt;);&lt;br&gt;        }&lt;br&gt;    }&lt;br&gt;});&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;重写Tosat&#34;&gt;&lt;a href=&#34;#重写Tosat&#34; class=&#34;headerlink&#34; title=&#34;重写Tosat&#34;&gt;&lt;/a&gt;重写Tosat&lt;/h3&gt;&lt;p&gt;​	参考这个例子能看到，js可以完全重写Android java层的代码。&lt;/p&gt;
&lt;figure class=&#34;highlight js&#34;&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs js&#34;&gt;&lt;span class=&#34;hljs-title class_&#34;&gt;Java&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;perform&lt;/span&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; (&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;) {&lt;br&gt;  &lt;span class=&#34;hljs-comment&#34;&gt;// hook类: MainActivity&lt;/span&gt;&lt;br&gt;  &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;hljs-title class_&#34;&gt;MainActivity&lt;/span&gt; = &lt;span class=&#34;hljs-title class_&#34;&gt;Java&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;use&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;com.yashu.aaaaaaaaaaaaaaaaaaaaaa.MainActivity&#34;&lt;/span&gt;);&lt;br&gt;  &lt;span class=&#34;hljs-comment&#34;&gt;// hook方法: MainActivity.onCreate&lt;/span&gt;&lt;br&gt;  &lt;span class=&#34;hljs-title class_&#34;&gt;MainActivity&lt;/span&gt;.&lt;span class=&#34;hljs-property&#34;&gt;onCreate&lt;/span&gt;.&lt;span class=&#34;hljs-property&#34;&gt;implementation&lt;/span&gt; = &lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; (&lt;span class=&#34;hljs-params&#34;&gt;savedInstanceState&lt;/span&gt;) {&lt;br&gt;    &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;enter onCreate&#34;&lt;/span&gt;);&lt;br&gt;    &lt;span class=&#34;hljs-comment&#34;&gt;// 不打断程序, 该执行的还要执行&lt;/span&gt;&lt;br&gt;    &lt;span class=&#34;hljs-comment&#34;&gt;// 执行this.onCreate, 且传参&lt;/span&gt;&lt;br&gt;    &lt;span class=&#34;hljs-variable language_&#34;&gt;this&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;onCreate&lt;/span&gt;(savedInstanceState);&lt;br&gt;  };&lt;br&gt;&lt;br&gt;  &lt;span class=&#34;hljs-comment&#34;&gt;// 获得Toast组件&lt;/span&gt;&lt;br&gt;  &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;hljs-title class_&#34;&gt;Toast&lt;/span&gt; = &lt;span class=&#34;hljs-title class_&#34;&gt;Java&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;use&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;android.widget.Toast&#34;&lt;/span&gt;);&lt;br&gt;  &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; makeText = &lt;span class=&#34;hljs-title class_&#34;&gt;Toast&lt;/span&gt;.&lt;span class=&#34;hljs-property&#34;&gt;makeText&lt;/span&gt;;&lt;br&gt;  &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;hljs-title class_&#34;&gt;String&lt;/span&gt; = &lt;span class=&#34;hljs-title class_&#34;&gt;Java&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;use&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;java.lang.String&#34;&lt;/span&gt;);&lt;br&gt;  &lt;span class=&#34;hljs-comment&#34;&gt;// 函数重载, 设置参数类型&lt;/span&gt;&lt;br&gt;  makeText.&lt;span class=&#34;hljs-title function_&#34;&gt;overload&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;android.content.Context&#34;&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&#34;java.lang.CharSequence&#34;&lt;/span&gt;, &lt;span class=&#34;hljs-string&#34;&gt;&#34;int&#34;&lt;/span&gt;).&lt;span class=&#34;hljs-property&#34;&gt;implementation&lt;/span&gt; = &lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt; (&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-params&#34;&gt;    context,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-params&#34;&gt;    content,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-params&#34;&gt;    time&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-params&#34;&gt;  &lt;/span&gt;) {&lt;br&gt;    &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;修改toast内容&#34;&lt;/span&gt;);&lt;br&gt;    &lt;span class=&#34;hljs-comment&#34;&gt;// 设置字符串重复次数&lt;/span&gt;&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; content = &lt;span class=&#34;hljs-string&#34;&gt;&#34;牙叔教程 超级棒棒\n&#34;&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;repeat&lt;/span&gt;(&lt;span class=&#34;hljs-number&#34;&gt;10&lt;/span&gt;);&lt;br&gt;    &lt;span class=&#34;hljs-comment&#34;&gt;// 实例化字符串&lt;/span&gt;&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; hookContent = &lt;span class=&#34;hljs-title class_&#34;&gt;String&lt;/span&gt;.$new(content);&lt;br&gt;    &lt;span class=&#34;hljs-comment&#34;&gt;// 可以hook, 但是不能打断原先的程序, 原来该做什么, 还要继续做下去&lt;/span&gt;&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-variable language_&#34;&gt;this&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;makeText&lt;/span&gt;(context, hookContent, time);&lt;br&gt;  };&lt;br&gt;});&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;h3 id=&#34;访问类属性&#34;&gt;&lt;a href=&#34;#访问类属性&#34; class=&#34;headerlink&#34; title=&#34;访问类属性&#34;&gt;&lt;/a&gt;访问类属性&lt;/h3&gt;&lt;figure class=&#34;highlight js&#34;&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs js&#34;&gt;&lt;span class=&#34;hljs-comment&#34;&gt;// 类的属性可通过 .属性名.value 访问。如果有函数与属性名相同，则需要使用下划线方式 ._属性名.value 访问。&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-title class_&#34;&gt;Java&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;perform&lt;/span&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;){&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; clazz = &lt;span class=&#34;hljs-title class_&#34;&gt;Java&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;use&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;com.zyc.fridademo.MainActivity&#34;&lt;/span&gt;);&lt;br&gt;    &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; calc = &lt;span class=&#34;hljs-title class_&#34;&gt;Java&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;use&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;com.zyc.fridademo.Calc&#34;&lt;/span&gt;);&lt;br&gt;    clazz.&lt;span class=&#34;hljs-property&#34;&gt;onCreate&lt;/span&gt;.&lt;span class=&#34;hljs-property&#34;&gt;implementation&lt;/span&gt; = &lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;)&lt;br&gt;    {&lt;br&gt;        &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;Hook MainActivity onCreate()...&#34;&lt;/span&gt;);&lt;br&gt;        &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; myCalc = calc.$new(&lt;span class=&#34;hljs-number&#34;&gt;10&lt;/span&gt;);&lt;br&gt;        &lt;span class=&#34;hljs-title function_&#34;&gt;send&lt;/span&gt;(myCalc.&lt;span class=&#34;hljs-property&#34;&gt;base&lt;/span&gt;.&lt;span class=&#34;hljs-property&#34;&gt;value&lt;/span&gt;);&lt;br&gt;        &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;修改一下base...&#34;&lt;/span&gt;);&lt;br&gt;        myCalc.&lt;span class=&#34;hljs-property&#34;&gt;base&lt;/span&gt;.&lt;span class=&#34;hljs-property&#34;&gt;value&lt;/span&gt; = &lt;span class=&#34;hljs-number&#34;&gt;88&lt;/span&gt;;&lt;br&gt;        &lt;span class=&#34;hljs-title function_&#34;&gt;send&lt;/span&gt;(myCalc.&lt;span class=&#34;hljs-property&#34;&gt;base&lt;/span&gt;.&lt;span class=&#34;hljs-property&#34;&gt;value&lt;/span&gt;);&lt;br&gt;        &lt;span class=&#34;hljs-keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;hljs-variable language_&#34;&gt;this&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;onCreate&lt;/span&gt;(&lt;span class=&#34;hljs-variable language_&#34;&gt;arguments&lt;/span&gt;[&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;]);&lt;br&gt;    }&lt;br&gt;});&lt;br&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;遍历已加载的类和方法&#34;&gt;&lt;a href=&#34;#遍历已加载的类和方法&#34; class=&#34;headerlink&#34; title=&#34;遍历已加载的类和方法&#34;&gt;&lt;/a&gt;遍历已加载的类和方法&lt;/h3&gt;&lt;figure class=&#34;highlight js&#34;&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs js&#34;&gt;&lt;span class=&#34;hljs-title class_&#34;&gt;Java&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;perform&lt;/span&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;){&lt;br&gt;    &lt;span class=&#34;hljs-title class_&#34;&gt;Java&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;enumerateLoadedClasses&lt;/span&gt;({&lt;br&gt;        onMatch : &lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;name,handle&lt;/span&gt;){&lt;br&gt;            &lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt;(name.&lt;span class=&#34;hljs-title function_&#34;&gt;indexOf&lt;/span&gt;(&lt;span class=&#34;hljs-string&#34;&gt;&#34;com.zyc.fridademo&#34;&lt;/span&gt;) != -&lt;span class=&#34;hljs-number&#34;&gt;1&lt;/span&gt;){&lt;br&gt;                &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(name);&lt;br&gt;                &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; clazz = &lt;span class=&#34;hljs-title class_&#34;&gt;Java&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;use&lt;/span&gt;(name);&lt;br&gt;                &lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; methods = clazz.&lt;span class=&#34;hljs-property&#34;&gt;class&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;getDeclaredMethods&lt;/span&gt;();&lt;br&gt;                &lt;span class=&#34;hljs-keyword&#34;&gt;for&lt;/span&gt;(&lt;span class=&#34;hljs-keyword&#34;&gt;var&lt;/span&gt; i=&lt;span class=&#34;hljs-number&#34;&gt;0&lt;/span&gt;;i&amp;lt;methods.&lt;span class=&#34;hljs-property&#34;&gt;length&lt;/span&gt;;i++){&lt;br&gt;                    &lt;span class=&#34;hljs-variable language_&#34;&gt;console&lt;/span&gt;.&lt;span class=&#34;hljs-title function_&#34;&gt;log&lt;/span&gt;(methods[i]);&lt;br&gt;                }&lt;br&gt;            }&lt;br&gt;        },&lt;br&gt;        &lt;span class=&#34;hljs-attr&#34;&gt;onComplete&lt;/span&gt;:&lt;span class=&#34;hljs-keyword&#34;&gt;function&lt;/span&gt;(&lt;span class=&#34;hljs-params&#34;&gt;&lt;/span&gt;){}&lt;br&gt;    });&lt;br&gt;});&lt;br&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;h2 id=&#34;参考链接&#34;&gt;&lt;a href=&#34;#参考链接&#34; class=&#34;headerlink&#34; title=&#34;参考链接&#34;&gt;&lt;/a&gt;参考链接&lt;/h2&gt;&lt;p&gt;&lt;a href=&#34;https://blog.csdn.net/zyc3545/article/details/114629718&#34;&gt;https://blog.csdn.net/zyc3545/article/details/114629718&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.csdn.net/zyc3545/article/details/114080220?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169642852316800226576512%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;amp;request_id=169642852316800226576512&amp;amp;biz_id=0&amp;amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-2-114080220-null-null.nonecase&amp;amp;utm_term=frida&amp;amp;spm=1018.2226.3001.4450&#34;&gt;https://blog.csdn.net/zyc3545/article/details/114080220?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169642852316800226576512%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;amp;request_id=169642852316800226576512&amp;amp;biz_id=0&amp;amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-2-114080220-null-null.nonecase&amp;amp;utm_term=frida&amp;amp;spm=1018.2226.3001.4450&lt;/a&gt;	&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.jianshu.com/p/2475cb4532c8&#34;&gt;https://www.jianshu.com/p/2475cb4532c8&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.csdn.net/q1921098027/article/details/127062229&#34;&gt;https://blog.csdn.net/q1921098027/article/details/127062229&lt;/a&gt;&lt;/p&gt;
 ]]></description>
        </item>
    </channel>
</rss>
